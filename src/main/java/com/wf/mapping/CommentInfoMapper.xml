<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wf.dao.CommentInfoMapper" >
  <resultMap id="BaseResultMap" type="com.wf.bean.CommentInfo" >
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="perio_id" property="perioId" jdbcType="VARCHAR" />
    <result column="user_id" property="userId" jdbcType="VARCHAR" />
    <result column="perio_name" property="perioName" jdbcType="VARCHAR" />
    <result column="author_name" property="authorName" jdbcType="VARCHAR" />
    <result column="submit_period" property="subTime" jdbcType="VARCHAR" />
    <result column="audit_money" property="auditMoney" jdbcType="VARCHAR" />
    <result column="layout_money" property="layoutMoney" jdbcType="VARCHAR" />
    <result column="creat_date" property="creatDate" jdbcType="DATE" />
    <result column="hire_con" property="hireCon" jdbcType="VARCHAR" />
    <result column="data_state" property="dataState" jdbcType="VARCHAR" />
    <result column="complaint_status" property="complaintStatus" jdbcType="VARCHAR" />
    <result column="handling_status" property="handlingStatus" jdbcType="INTEGER" />
    <result column="comment_content" property="commentContent" jdbcType="LONGVARCHAR" />
    <result column="preliminary_opinions" property="preliminaryOpinions" jdbcType="LONGVARCHAR" />
    <result column="appeal_reason" property="appealReason" jdbcType="LONGVARCHAR" />
    <result column="final_opinion" property="finalOpinion" jdbcType="LONGVARCHAR" />
    <result column="is_submit" property="isSubmit" jdbcType="INTEGER" />
  </resultMap>
  <sql id="sqllist" >
    id, perio_id, user_id, perio_name, author_name, submit_period, audit_money, layout_money, 
    creat_date, hire_con, data_state, complaint_status, handling_status, is_submit,comment_content,
    preliminary_opinions, appeal_reason, final_opinion
  </sql>
  
  <select id="getComment" resultMap="BaseResultMap" >
  select * from comment_info where 1=1
   <if test="info.authorName!=null and info.authorName !=''">
  	and author_name=#{info.authorName}
  </if>
  <if test="info.perioName!=null and info.perioName !=''">
  	and perio_name like CONCAT('%',#{info.perioName},'%')
  </if>
    <if test="startTime!=null and startTime !=''">
  	and creat_date &gt;= '${startTime}' 
  </if>
  <if test="endTime!=null and endTime !=''">
  and creat_date &lt;= '${endTime}'
  </if>
    <if test="info.subTime!=null and info.subTime!=''">
  	and submit_period=#{info.subTime}
  </if>
   <if test="sauditm!=null and sauditm !='' ">
  	and audit_money &gt;= ${sauditm} 
  </if>
  <if test="eauditm!=null and eauditm !=''">
  and audit_money  &lt;= ${eauditm}
  </if>
    <if test="slayoutm!=null and slayoutm !=''">
  	and layout_money &gt;= ${slayoutm} 
  </if>
  <if test=" elayoutm!=null and elayoutm !=''">
  and layout_money &lt;= ${elayoutm}
  </if>
  <if test="dataState!=null">
    and data_state in
  <foreach collection="dataState" index="index" item="item" open="(" separator="," close=")">
      #{item}
  </foreach>
  </if>
  <if test="complaintStatus!=null">
    and complaint_status in
     <foreach collection="complaintStatus" index="index" item="item" open="(" separator="," close=")">
      	#{item}
  	 </foreach>
  </if> 
   limit #{pagenum},#{pagesize}
  </select>
  
   <select id="getCommentCount" resultType="int" >
  select count(1) from comment_info where 1=1
  <if test="info.authorName!=null and info.authorName !=''">
  	and author_name=#{info.authorName}
  </if>
  <if test="info.perioName!=null and info.perioName !=''">
  	and perio_name like CONCAT('%',#{info.perioName},'%')
  </if>
   <if test="startTime!=null and startTime !=''">
  	and creat_date 	&gt;= '${startTime}' 
  </if>
  <if test="endTime!=null and endTime !=''">
  and creat_date  &lt;='${endTime}'
  </if>
  <if test="info.subTime!=null and info.subTime !=''">
  	and submit_period=#{info.subTime}
  </if>
  <if test="sauditm!=null and sauditm !='' ">
  	and audit_money &gt;= ${sauditm} 
  </if >
  <if test=" eauditm!=null and eauditm !=''">
  and audit_money  &lt;= ${eauditm}
  </if>
   <if test="slayoutm!=null and slayoutm !=''">
  	and layout_money &gt;= ${slayoutm} 
  </if>
  <if test=" elayoutm!=null and elayoutm !=''">
  and layout_money &lt;= ${elayoutm}
  </if>
  
  <if test="dataState!=null">
    and data_state in
  <foreach collection="dataState" index="index" item="item" open="(" separator="," close=")">
      #{item}
  </foreach>
  </if>
  <if test="complaintStatus!=null">
    and complaint_status in
     <foreach collection="complaintStatus" index="index" item="item" open="(" separator="," close=")">
      	#{item}
  	 </foreach>
  </if>
  </select>
  
 <update id="changetype" >
 	update  comment_info set data_state=#{info.dataState},handling_status=#{info.handlingStatus}   where user_id=#{info.userId} and id=#{info.id}
 </update>

  <update id="updateNotes" >
 	update  comment_info set data_state=#{info.dataState},handling_status=#{info.handlingStatus},complaint_status=#{info.complaintStatus}, final_opinion = #{info.finalOpinion}  where  id=#{info.id}
 </update>
 
 <update id="handlingStatus" >
 	update  comment_info set handling_status=#{info.handlingStatus}  where  id=#{info.id}
 </update>
 <select id="findNote" resultMap="BaseResultMap" >
 select * from comment_info where id=#{info.id}
 </select>
 
  <select id="findNotes" resultMap="BaseResultMap" >
 select * from comment_info where id=#{info.id}
 </select>
 
  <select id="getCommentAll" resultMap="BaseResultMap" >
  	select * from comment_info where 1=1
   <if test="info.userId!=null and info.userId !=''">
  	and user_id=#{info.userId}
  </if>
  <if test="info.perioName!=null and info.perioName !=''">
  	and perio_name like CONCAT('%',#{info.perioName},'%')
  </if>
    <if test="startTime!=null and startTime !=''">
  	and creat_date &gt;=  '${startTime}' 
  </if>
  <if test="endTime!=null and endTime !=''">
  and creat_date &lt;='${endTime}'
  </if>
    <if test="info.subTime!=null and info.subTime!=''">
  	and submit_period=#{info.subTime}
  </if>
   <if test="sauditm!=null and sauditm !='' ">
  	and audit_money &gt;= ${sauditm} 
  </if>
  <if test="eauditm!=null and eauditm !=''">
  and audit_money  &lt;= ${eauditm}
  </if>
    <if test="slayoutm!=null and slayoutm !=''">
  	and layout_money &gt;= ${slayoutm} 
  </if>
  <if test=" elayoutm!=null and elayoutm !=''">
  and layout_money &lt;= ${elayoutm}
  </if>
  <if test="dataState!=null">
    and data_state in
  <foreach collection="dataState" index="index" item="item" open="(" separator="," close=")">
      #{item}
  </foreach>
  </if>
  <if test="complaintStatus!=null">
    and complaint_status in
     <foreach collection="complaintStatus" index="index" item="item" open="(" separator="," close=")">
      	#{item}
  	 </foreach>
  </if> 
 </select>
 
 
</mapper>