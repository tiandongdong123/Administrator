<? directive dynamic map;?>
<?
	layout("/inc/layout.html",{title:'知识服务平台后台管理系统'}){
?>
<link rel="stylesheet" href="../page/contentmanage/css/findMessage.css">
<script type="text/javascript" src="../js/laypage-v1.3/laypage/laypage.js"></script>
<script type="text/javascript" src="../page/usermanager/js/ins_sonaccount.js"></script>
<div class="content-wrapper">
	<section class="content-header"><h1>机构子账号信息管理</h1></section>
    <!-- Main content -->
    <section class="content">
	<div class="row">
    	<div class="col-md-6">
      	<div class="box box-primary">
        <div class="box-body">
         <form action="../auser/tosonaccount.do" method="post" id="fromList">
		<table style="width:60%">
			<tr><td>
			<label class="input_name">用户ID</label>
			<input type="text" class="form-control input_width" name="userId" id="userId" value="${map.userId!}" onkeyup="this.value=this.value.replace(/^\s+|\s+$/gm,'')" onafterpaste="this.value=this.value.replace(/^\s+|\s+$/gm,'')">
			</td></tr>
			<tr><td>
			<label class="input_name">机构名称</label>
			<input type="text" class="form-control input_width" name="institution" id="institution" value="${map.institution!}" onkeyup="this.value=this.value.replace(/^\s+|\s+$/gm,'')" onafterpaste="this.value=this.value.replace(/^\s+|\s+$/gm,'')">
			</td></tr>
			<tr><td>
			<label class="input_name">注册日期</label>
			<span class="time_block"><input type="text" class="Wdate" name="start_time" id="start_time" value="${map.start_time!}" onclick="WdatePicker({dateFmt:'yyyy-MM-dd',maxDate:'#F{$dp.$D(\'end_time\')}'})"></span><span class="to"> 至 </span>
			<span class="time_block"><input type="text" class="Wdate" name="end_time" id="end_time" value="${map.end_time!}" onclick="WdatePicker({dateFmt:'yyyy-MM-dd',minDate:'#F{$dp.$D(\'start_time\')}'})"></span>
			</td></tr>
		</table>
		<input type="hidden" id="isBack" name="isBack" value="${map.isBack!}">
		<input type="hidden" id="goPage" name="goPage" value="">
		<?if(!isEmpty(map.pageList)){?>
	        <input type="hidden" id="pageNum" name="pageNum" value="${map.pageList.pageNum!}">
	        <input type="hidden" id="pageSize" name="pageSize" value="${map.pageList.pageSize!}">
	        <input type="hidden" id="totalRow" name="totalRow" value="${map.pageList.totalRow!}">
		<?}?>
		<div style="text-align: center;width: 550px;margin-top: 2%;">
		 	<button type="submit" class="btn btn-primary" onclick="findList()">查询</button>
		</div>
		</form>
		<br/><br/>
		<div style="overflow-y :auto;position:relative">
			<div  class="box-body no-padding">
				<div class="mailbox-controls">
                	<button type="button" style="width: 100px;" class="btn btn-default btn-sm" onclick="exportexecl()">导出</button>
                	<?if(!isEmpty(map.isBack)){?><button type="button" style="width: 100px;" class="btn btn-default btn-sm" onclick="goInformation('${map.pid}');">返回</button><?}?>
				</div>
				<div class="table-responsive mailbox-messages">
					<table class="table table-bordered table-striped"><tbody>
					<tr style='text-align: center;'>
						<td class='mailbox-star'>序号</td>
						<td class="mailbox-name">机构名称</td>
						<td class="mailbox-name">机构ID</td>
						<td class="mailbox-name">子账号上限</td>
						<td class="mailbox-name">子账号并发数上限</td>
						<td class="mailbox-name">子账号下载量上限/天</td>
						<td class="mailbox-name">子账号扣款模式</td>
						<td class="mailbox-name">子账号类型</td>
						<td class="mailbox-name">子账号名称</td>
						<td class="mailbox-name">子账号ID</td>
						<td class="mailbox-name">子账号密码</td>
						<td class="mailbox-name">子账号IP</td>
						<td class="mailbox-name">子账号注册时间</td>
						<td class="mailbox-name">子账号权限</td>
						<td class="mailbox-name">购买数据库</td>
						<td class="mailbox-name">子账号有效期</td>
						<td class="mailbox-name">子账号余额</td>
						<td class="mailbox-name">子账号次数</td>
					</tr>
					<?if(!isEmpty(map.pageList)){?>
					<? var i=0; for(list in map.pageList.pageRow){ i++; ?>
					<tr style='text-align: center;'>
					<td class='mailbox-star'><div style='width:20px;'>${i+20*(map.pageList.pageNum-1)}</div></td>
					<td class='mailbox-star'><div style='word-break:break-all;width:100px;'>${list.institution!}</div></td>
					<td class='mailbox-star'><div style='word-break:break-all;width:100px;'>${list.pid!}</div></td>
					<td class='mailbox-star'><div style='width:60px;'>${list.upperlimit!}</div></td>
					<td class='mailbox-star'><div style='width:100px;'>${list.sConcurrentnumber!}</div></td>
					<td class='mailbox-star'><div style='width:100px;'>${list.downloadupperlimit!}</div></td>
					<td class='mailbox-star'><div style='word-break:break-all;width:100px;'><?if(list.chargebacks==0){?>从机构账号扣款<?}?><?if(list.chargebacks==1){?>从机构子账号扣款<?}?></div></td>
					<td class='mailbox-star'><div style='word-break:break-all;width:100px;'><?if(list.userRoles==0){?>子账号<?}?><?if(list.userRoles==20){?>学生账号<?}?></div></td>
					<td class='mailbox-star'><div style='word-break:break-all;width:100px;'>${list.userRealname!}</div></td>
					<td class='mailbox-star'><div style='word-break:break-all;width:100px;'>${list.userId!}</div></td>
					<td class='mailbox-star'><div style='word-break:break-all;width:100px;'>${list.password!}</div></td>
					<td class='mailbox-star'><div style='word-break:break-all;width:180px;'><?if(!isEmpty(list.list_ip)){ var g=0; for(info in list.list_ip){ g++;?>${info.ip}<?if(g<list.list_ip.~size){?></br><?}?><?}?><?}?></div></td>
					<td class='mailbox-star'><div style='word-break:break-all;width:100px;'>${list.registrationTime!,"yyyy-MM-dd hh:mm:ss"}</div></td>
					<td colspan="5" width=100% height=100% margin-bottom="0"><table class="table" width=100% height=100% margin-bottom="0"><tbody>
					<? if(!isEmpty(list.data)){ for(data in list.data){ ?>
					<tr>
						<td class='mailbox-star'><div style='word-break:break-all;width:100px;'>${data.name!}</div></td>
						<td class='mailbox-star'><div style='word-break:break-all;width:100px;'>${data.resouceName!}</div></td>
						<td class='mailbox-star'><div style='word-break:break-all;width:100px;'>${data.time!}</div></td>
						<td class='mailbox-star'><div style='width:100px;'><?if(list.chargebacks==1){?>${data.balance!}<?}?></div></td>
						<td class='mailbox-star'><div style='width:100px;'><?if(list.chargebacks==1){?>${data.count!}<?}?></div></td>
					</tr>
					<?}}?></tbody>
					</table>
					</td>
					</tr>
					<?}}?>
					</tbody>
					</table>
				</div>
				<?if(!isEmpty(msg)&&(isEmpty(map.pageList)||map.pageList.totalRow==0)){?><div style="text-align:center;"><span style="color:red">查询无结果</span><div><?}?>
				<?if(!isEmpty(map.pageList)&&map.pageList.totalRow>20){?><div id="page"></div><?}?>
          </div>
        </div>
        <!-- body end -->
        </div>
        </div>
        </div>
	</div>
</section>
</div>	
<?}?>