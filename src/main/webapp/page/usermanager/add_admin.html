	<?
	  include("/inc/header.html") {}
    ?>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
</head>
<body>
<?include("/inc/header.html"){}?>
<script type="text/javascript" src="../page/usermanager/js/ins_information.js"></script>
<script type="text/javascript" src="../page/usermanager/js/public.js"></script>
<script type="text/javascript" src="../page/usermanager/js/validation_user.js"></script>
<script type="text/javascript">


	function addOrUpateAdminInfo(){
		var adminname = $("#adminname").val().trim();
		var adminpassword = $("#adminpassword").val().trim();
		var adminEmail = $("#adminEmail").val().trim();
		var adminIp = $("#adminIP").val().trim();
		if(!validateFrom()){
			return false;
		}else if(adminIp!="" && !IpFormat(adminIp)){
			layer.msg("管理员IP段格式有误",{icon: 2});
		}else{
			 $.ajax({
				type : "post",
				url : "../auser/addadmin.do",
				data:{"adminname": adminname,
					"adminpassword" : adminpassword,
					"adminIP" : adminIp,
					"adminEmail" : adminEmail,
					"userId" : $("#userId").val(),
					"institution" : $("#institution").val(),
					"managerType" : $("input[name='managerType']:checked").val(),
					"adminOldName" : $("#adminOldName").val()
				},
				beforeSend: function(){
					$("#submit").attr({disabled: "disabled"});
				},
				success: function(data){
				   if(data == "true"){
					   layer.msg('操作成功', {icon: 1});
				   }else if(data=="false"){
					   layer.msg('机构管理员被占用', {icon: 2});
				   }else{
					   layer.msg('操作失败', {icon: 2});
				   }
				   //window.close();
				   if(data == "true"){
					   window.parent.findList();
				   }
				},
				complete: function(){
					$("#submit").removeAttr("disabled");
				}
			});
		}
	}
</script>
    <section class="content">
      <div class="row">
        <div class="col-md-6">
          <div class="box box-primary">
          <input type="hidden" id="userId" value="${userId}">
          <input type="hidden" id="institution" value="${institution}">
          <form id="fromList" method="post">
          
	          <div class="form-group input_block">
              		<label class="input_name"><b style="color: #FF0000;margin-right: 5px;">*</b>管理员类型</label>
              		<input type="radio" name="managerType" value="old"  onclick="radioClick('update');"/>选择已有管理员
                  	<input type="radio" checked="checked" name="managerType" value="new" onclick="radioClick();"/>创建新管理员
	         </div>
          	<div id="newManager">
          		<div id="administrator">
                <div class="form-group input_block">
                  <label class="input_name"><b style="color: #FF0000;margin-right: 5px;">*</b>管理员ID</label>
                  <input type="text" class="form-control input_width" name="adminname" id="adminname" <?if(flag=='1'){?>readonly="readonly"<?}?> value="${map.userId!}">
                </div>
                <div class="form-group input_block">
                  <label class="input_name"><b style="color: #FF0000;margin-right: 5px;">*</b>管理员密码</label>
                  <input type="text" class="form-control input_width" name="adminpassword" id="adminpassword" value="${map.password!}">
                </div>
                <div class="form-group input_block">
                  <label class="input_name">管理员IP段</label>
                  <textarea class="form-control input_width" style="margin: 0px; width: 324px; height: 215px;" rows="3" name="adminIP" id="adminIP"><?if(!isEmpty(map.adminIP)){?><?for(ip in map.adminIP){?>${ip.beginIpAddressNumber}-${ip.endIpAddressNumber}&#13;&#10;<?}?><?}?></textarea>
                </div>
                <div class="form-group input_block">
                  <label class="input_name"><b style="color: #FF0000;margin-right: 5px;">*</b>管理员邮箱</label>
                  <input type="text" class="form-control input_width" name="adminEmail" id="adminEmail" value="${map.adminEmail!}">
                </div>
             </div>
          </div>
         <div class="form-group input_block" id="oldManager" style="display: none;">
          <label class="input_name"><b style="color: #FF0000;margin-right: 5px;">*</b>管理员ID</label>
          <select class="form-control input_width" name="adminOldName" id="adminOldName">
			<option value="">-请选择管理员ID-</option>
          </select>
         </div>
        </form>
		<div class="block_left">
		  <button type="button" class="btn btn-primary" id="submit" onclick="addOrUpateAdminInfo();">提交</button>
		  <button type="button" class="btn btn-primary" onclick="location=location;">重置</button>
		</div>
        </div>
        </div>
      </div>
   </section>
</body>
</html>